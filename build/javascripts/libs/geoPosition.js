// Copyright J. Esteban Acosta VillafaÃ±e
function handleBlackBerryLocationTimeout(){-1!=bb.blackberryTimeoutId&&bb.error({message:"Timeout error",code:3})}function handleBlackBerryLocation(){if(clearTimeout(bb.blackberryTimeoutId),bb.blackberryTimeoutId=-1,bb.success&&bb.error){if(0==blackberry.location.latitude&&0==blackberry.location.longitude)bb.error({message:"Position unavailable",code:2});else{var e=null;blackberry.location.timestamp&&(e=new Date(blackberry.location.timestamp)),bb.success({timestamp:e,coords:{latitude:blackberry.location.latitude,longitude:blackberry.location.longitude}})}bb.success=null,bb.error=null}}var bb={success:0,error:0,blackberryTimeoutId:-1},geoPosition=function(){var e={},o=null,t="undefined",i="http://freegeoip.net/json/?callback=JSONPCallback";return e.getCurrentPosition=function(e,t,i){o.getCurrentPosition(e,t,i)},e.jsonp={callbackCounter:0,fetch:function(e,o){var t="JSONPCallback_"+this.callbackCounter++;window[t]=this.evalJSONP(o),e=e.replace("=JSONPCallback","="+t);var i=document.createElement("SCRIPT");i.src=e,document.getElementsByTagName("HEAD")[0].appendChild(i)},evalJSONP:function(e){return function(o){e(o)}}},e.confirmation=function(){return confirm("This Webpage wants to track your physical location.\nDo you allow it?")},e.init=function(){try{var n=typeof navigator.geolocation!=t;if(!n&&!e.confirmation())return!1;if(typeof geoPositionSimulator!=t&&geoPositionSimulator.length>0)o=geoPositionSimulator;else if(typeof bondi!=t&&typeof bondi.geolocation!=t)o=bondi.geolocation;else if(n)o=navigator.geolocation,e.getCurrentPosition=function(e,i,n){function a(o){var i;i=typeof o.latitude!=t?{timestamp:o.timestamp,coords:{latitude:o.latitude,longitude:o.longitude}}:o,e(i)}o.getCurrentPosition(a,i,n)};else if(typeof window.blackberry!=t&&blackberry.location.GPSSupported){if(typeof blackberry.location.setAidMode==t)return!1;blackberry.location.setAidMode(2),e.getCurrentPosition=function(e,o,t){bb.success=e,bb.error=o,bb.blackberryTimeoutId=t.timeout?setTimeout("handleBlackBerryLocationTimeout()",t.timeout):setTimeout("handleBlackBerryLocationTimeout()",6e4),blackberry.location.onLocationUpdate("handleBlackBerryLocation()"),blackberry.location.refreshLocation()},o=blackberry.location}else typeof Mojo!=t&&"Mojo.Service.Request"!=typeof Mojo.Service.Request?(o=!0,e.getCurrentPosition=function(e,o,t){parameters={},t&&(t.enableHighAccuracy&&1==t.enableHighAccuracy&&(parameters.accuracy=1),t.maximumAge&&(parameters.maximumAge=t.maximumAge),t.responseTime&&(t.responseTime<5?parameters.responseTime=1:t.responseTime<20?parameters.responseTime=2:parameters.timeout=3)),r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:parameters,onSuccess:function(o){e({timestamp:o.timestamp,coords:{latitude:o.latitude,longitude:o.longitude,heading:o.heading}})},onFailure:function(e){1==e.errorCode?o({code:3,message:"Timeout"}):2==e.errorCode?o({code:2,message:"Position unavailable"}):o({code:0,message:"Unknown Error: webOS-code"+errorCode})}})}):typeof device!=t&&typeof device.getServiceObject!=t?(o=device.getServiceObject("Service.Location","ILocation"),e.getCurrentPosition=function(e,t){function i(o,i,n){4==i?t({message:"Position unavailable",code:2}):e({timestamp:null,coords:{latitude:n.ReturnValue.Latitude,longitude:n.ReturnValue.Longitude,altitude:n.ReturnValue.Altitude,heading:n.ReturnValue.Heading}})}var n=new Object;n.LocationInformationClass="BasicLocationInformation",o.ILocation.GetLocation(n,i)}):(e.getCurrentPosition=function(o){e.jsonp.fetch(i,function(e){o({timestamp:e.timestamp,coords:{latitude:e.latitude,longitude:e.longitude,heading:e.heading}})})},o=!0)}catch(a){return typeof console!=t&&console.log(a),!1}return null!=o},e}();